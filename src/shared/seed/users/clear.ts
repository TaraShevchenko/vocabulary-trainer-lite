import { PrismaClient } from "@prisma/client";

const prisma = new PrismaClient();

/**
 * ÐžÑ‡Ð¸Ñ‰Ð°ÐµÑ‚ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸Ð· Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… PostgreSQL
 * ÐÐ• Ð·Ð°Ñ‚Ñ€Ð°Ð³Ð¸Ð²Ð°ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² Clerk - Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…
 */
async function clearUsersFromDatabase() {
  console.log("ðŸ§¹ ÐÐ°Ñ‡Ð¸Ð½Ð°ÐµÐ¼ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÑƒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸Ð· Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…...");
  console.log("â„¹ï¸ Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð² Clerk ÐÐ• Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð°Ñ‚Ñ€Ð¾Ð½ÑƒÑ‚Ñ‹");

  try {
    // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¿ÐµÑ€ÐµÐ´ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸ÐµÐ¼
    const userCount = await prisma.user.count();
    console.log(`ðŸ“Š ÐÐ°Ð¹Ð´ÐµÐ½Ð¾ ${userCount} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð² Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…`);

    if (userCount === 0) {
      console.log("â„¹ï¸ Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… ÑƒÐ¶Ðµ Ð¿ÑƒÑÑ‚Ð° - Ð½ÐµÑ‡ÐµÐ³Ð¾ ÑƒÐ´Ð°Ð»ÑÑ‚ÑŒ");
      return { deleted: 0 };
    }

    // Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸Ð· Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
    console.log("ðŸ—‘ï¸ Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð²ÑÐµÑ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸Ð· PostgreSQL...");
    const deleteResult = await prisma.user.deleteMany({});

    console.log(
      `âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¾ ${deleteResult.count} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸Ð· Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…`,
    );
    console.log("â„¹ï¸ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð² Clerk Ð¾ÑÑ‚Ð°Ð»Ð¸ÑÑŒ Ð½ÐµÑ‚Ñ€Ð¾Ð½ÑƒÑ‚Ñ‹Ð¼Ð¸");
    console.log(
      "ðŸ’¡ Ð”Ð»Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ: npm run db:seed:users",
    );

    return { deleted: deleteResult.count };
  } catch (error) {
    console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹:", error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

/**
 * ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸
 */
async function main() {
  try {
    console.log("ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸Ð· Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…...");

    const result = await clearUsersFromDatabase();

    console.log("\nðŸŽ‰ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾!");
    console.log(`ðŸ“Š Ð£Ð´Ð°Ð»ÐµÐ½Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹: ${result.deleted}`);
  } catch (error) {
    console.error("ðŸ’¥ ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ°:", error);
    process.exit(1);
  }
}

// Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÑƒ ÐµÑÐ»Ð¸ Ñ„Ð°Ð¹Ð» Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ
main().catch((e) => {
  console.error(e);
  process.exit(1);
});

export { clearUsersFromDatabase };
